# tripSeat 專題需求分析與功能拆解 (修正版)

本文件已根據使用者回饋進行修正，重點在於取消「事前審核」機制，改為「事後管理」與「軟刪除」策略。

## 1. 角色權限矩陣 (Role-Permission Matrix)

| 功能模組 | 訪客 (Visitor) | 會員 (Member) | 管理員 (Admin) |
| :--- | :---: | :---: | :---: |
| **帳號管理** | 註冊即登入、社交登入、密碼重設 | 編輯資料、停用帳號(軟刪除) | 搜尋使用者、**停權或限制**違規帳號 |
| **旅程瀏覽** | 搜尋、篩選、查看詳情、心得瀏覽 | 搜尋、篩選、查看詳情、心得瀏覽 | 監控所有旅程狀態 |
| **旅程操作** | - | 建立/編輯/取消旅程 | **下架(封鎖)**違規旅程 |
| **報名管理** | - | 提交申請(含自介)、退出、查看名單 | - |
| **審核決策** | - | 團主審核(接受/拒絕)報名者 | 處理檢舉案件、維持平台秩序 |
| **評價互動** | 查看他人心得、平台回饋 | 撰寫旅程心得、評價同行者 | 處理(軟刪除)不當留言與檢舉 |
| **通知系統** | - | 報名/成團/停權通知 | 檢舉處理提示 |

## 2. 核心管理邏輯與機制

### A. 軟刪除 (Soft Delete) 策略

- **原理**：所有表格均包含 `deleted_at` 欄位。當資料被「刪除」時，僅記錄時間，系統查詢時會自動過濾掉 `deleted_at` 不為空的資料。
- **優點**：防止誤刪資料無法找回，且管理員仍可查閱歷史違規記錄。

### B. 管理員權限：事後管理 (Post-Management)

- **非事前審核**：用戶註冊與發布旅程無需等待管理員核准，提升用戶體驗。
- **違規處理**：管理員透過檢舉系統或日常巡檢發現違規後，將 `users.status` 或 `trips.status` 改為 `blocked`，或直接執行軟刪除。

### C. 旅程生命週期 (修正)

- **狀態流轉**：`草稿` -> `發布(Open)` -> `成團(Confirmed)` / `未成團` -> `已結束` / `取消` / `被封鎖(Blocked)`。
- **資訊保護**：僅成團後的參與者可查看彼此的聯絡方式。

## 3. 技術實作建議

- **資料庫查詢**：在開發 API 時，必須在所有 `SELECT` 語句中加入 `WHERE deleted_at IS NULL`。
- **狀態管理**：
  - 用戶 `blocked`：無法登入或僅能瀏覽無法操作。
  - 旅程 `blocked`：從搜尋清單移除，原有參與者收到通知。

### 🔍 搜尋與關鍵字策略

為了讓使用者快速找到旅程，我們採用以下邏輯：

1. **全域模糊搜尋**：利用 `json-server` 的 `q` 參數，自動比對 `title`、`description` 與 `tags`。
2. **分類篩選 (Categories)**：資料庫將維護一份「熱門分類」清單，顯示於首頁供快速點擊。
3. **標籤聯想 (Suggested Tags)**：從 `trips.tags` 中動態提取不重複的標籤作為搜尋建議。

### 🔌 第三方登入 (Google Login) 實作策略

由於 `json-server-auth` 本身只處理帳號密碼，針對 Google 登入我們採用 **「前端橋接法」**：

1. **驗證**：前端透過 Google 官方 SDK 完成登入。
2. **對接**：前端拿回 Email 後，檢查 `db.json`。
   - **新用戶**：前端自動調用 `/register` 並帶入一個系統預設的固定密碼 (例如 `google_user_pwd_123`)。
   - **舊用戶**：前端自動調用 `/login` 使用該固定密碼。
3. **結果**：Google 用戶與一般用戶一樣能獲得 JWT Token，可無縫使用後續受保護的功能。

---
> [!TIP]
> 採用軟刪除與事後管理機制，能讓平台維運更具彈性，同時保留數據的完整性。
